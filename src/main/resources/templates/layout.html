<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>



    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title layout:title-pattern="${CONTENT_TITLE} - ITravel">ITravel</title>
    <meta name="description" content="">
    <meta name="keywords" content="">
    <meta th:if="${_csrf != null}" name="_csrf" th:content="${_csrf.token}"/>
    <meta th:if="${_csrf != null}" name="_csrf_header" th:content="${_csrf.headerName}"/>


    <!-- Fonts -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

    <link href="https://fonts.googleapis.com" rel="preconnect">
    <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Raleway:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
    <!-- Bootstrap -->
    <link th:href="@{/vendor/bootstrap/css/bootstrap.css}" rel="stylesheet">

    <!-- GLightbox -->
    <link th:href="@{/vendor/glightbox/css/glightbox.min.css}" rel="stylesheet">


    <!-- CSS propriu -->
    <link th:href="@{/css/style.css}" rel="stylesheet">

    <!-- =======================================================
    * Template Name: TravelTime
    * Template URL: https://bootstrapmade.com/traveltime-bootstrap-travel-template/
    * Updated: Jul 28 2025 with Bootstrap v5.3.7
    * Author: BootstrapMade.com
    * License: https://bootstrapmade.com/license/
    ======================================================== -->
</head>
<header id="header" class="header d-flex align-items-center fixed-top">
    <div class="container position-relative d-flex align-items-center justify-content-between">

        <a th:href="@{/Itravel}" class=" logo d-flex align-items-center me-auto me-xl-0">
            <!-- Uncomment the line below if you also wish to use an image logo -->

            <!--                <<img th:src="@{/walpaper/walpaper-image.jpg}" alt="">-->


            <h1 class="sitename">ITravel</h1>
        </a>


        <nav id="navmenu" class="navmenu" >
            <ul>
                <li><a th:href="@{/Itravel}" class="active">Home</a></li>
                <li><a th:href="@{/About}">About</a></li>
                <li><a th:href="@{/Destinations}">Destinations</a></li>
                <li sec:authorize="hasRole('User') and !hasAnyRole('Guide')">
                    <a th:href="@{/trips}">Trips</a>
                </li>

                <!-- Ghid → Tours -->
                <li sec:authorize="hasRole('Guide')">
                    <a th:href="@{/Tours}">Tours</a>
                </li>



                <li class="dropdown"><a href="#"><span>More Pages</span> <i class="bi bi-chevron-down toggle-dropdown"></i></a>
                    <ul>
                        <li><a href="destination-details.html">Destination Details</a></li>
                        <li><a th:href="@{/Tour_details}">Tour Details</a></li>
                        <li><a href="booking.html">Booking</a></li>
                        <li><a href="testimonials">Testimonials</a></li>
                        <li><a href="faq.html">Frequently Asked Questions</a></li>
                        <li><a href="blog-details.html">Blog Details</a></li>
                        <li><a th:href="@{/Terms}">Terms</a></li>
                        <li><a th:href="@{/Privacy}">Privacy</a></li>

                    </ul>
                </li>
                <li sec:authorize="isAuthenticated()" class="dropdown">
                    <a href="#"><span>Dropdown</span> <i class="bi bi-chevron-down toggle-dropdown"></i></a>
                    <ul class="custom-dropdown">
                        <li><a href="#">Dropdown 1</a></li>

                        <!-- doar ghid -->
                        <li sec:authorize="hasRole('Guide')" class="dropdown">
                            <a href="#"><span>Deep Dropdown</span> <i class="bi bi-chevron-down toggle-dropdown"></i></a>
                            <ul class="custom-dropdown">
                                <li><a th:href="@{/Itravel/new}">Create</a></li>
                                <li><a href="#">Deep Dropdown 2</a></li>
                            </ul>
                        </li>

                        <li><a href="#">Dropdown 2</a></li>
                        <li><a href="#">Dropdown 3</a></li>
                    </ul>
                </li>



                <li><a th:href="@{/Contact}" >Contact</a></li>
                <!--<li sec:authorize="isAnonymous()">
                    <a href="#" data-bs-toggle="modal" data-bs-target="#loginModal">Login</a>
                </li>-->
                <li class="theme-toggle-li">
                    <button id="themeToggle" class="btn btn-theme" type="button"
                            aria-label="Toggle theme" aria-pressed="false" title="Toggle theme">
                        <i class="bi bi-sun"></i>  <!-- soare când e LIGHT -->
                    </button>
                </li>

            </ul>
            <i class="mobile-nav-toggle d-xl-none bi bi-list"></i>
        </nav>

        <!-- Slotul din dreapta: Login / Meniu utilizator -->
        <div class="right-cta d-flex align-items-center">
            <!-- Când NU ești logat: Login -->
            <a sec:authorize="isAnonymous()"
               href="#"
               class="btn-getstarted"
               data-bs-toggle="modal" data-bs-target="#loginModal">
                Login
            </a>
            <li sec:authorize="isAuthenticated()" class="account-item d-flex align-items-center">

                <div class="avatar-container me-2"
                     data-bs-toggle="modal"
                     data-bs-target="#avatarModal"
                     style="cursor: pointer; position: relative;">

                    <!-- Avatar -->
                    <img th:src="${navbarAvatarUrl}"
                         alt="Avatar"
                         class="avatar"
                         th:classappend="${navbarLevelClass}">

                    <!-- Rama GIF -->
                    <img th:if="${navbarFrameGif != null}"
                         th:src="@{${navbarFrameGif}}"
                         class="avatar-frame">

                    <!-- Badge puncte (doar User) -->
                    <span sec:authorize="hasRole('User') and !hasRole('Guide')"
                          class="badge points"
                          th:text="${navbarPoints} + 'p'"></span>

                    <!-- Badge nivel -->
                    <span class="badge level"
                          sec:authorize="isAuthenticated()"
                          th:text="'Lvl ' + ${navbarLevel}"></span>

                    <!-- Badge User -->
                    <span class="badge role User"
                          sec:authorize="hasRole('User') and !hasRole('Guide')">
        <i class="bi bi-person-fill"></i> User
    </span>

                    <!-- Badge Guide -->
                    <span class="badge role Guide"
                          sec:authorize="hasRole('Guide')">
        <i class="bi bi-geo-alt-fill"></i> Guide
    </span>

                </div>



                <!-- Toggle Cont -->
                <a href="#" class="account-toggle d-flex align-items-center">
    <span class="account-name">
        <b sec:authentication="name"></b>
    </span>
                    <i class="bi bi-chevron-down toggle-dropdown ms-1"></i>
                </a>

                <!-- Meniu -->
                <div class="account-menu">
                    <ul>
                        <li><a th:href="@{/user_profile}">Profilul meu</a></li>
                        <li><a th:href="@{/logout}">Logout</a></li>
                    </ul>
                </div>

        </div>
    </div>
</header>
<!-- Fragmentul pentru conținutul paginii copil -->
<div layout:fragment="content"></div>

<!-- Footer -->
<footer id="footer" class="footer position-relative dark-background">

    <div class="container">
        <div class="row gy-5">

            <div class="col-lg-4">
                <div class="footer-content">
                    <a href="index.html" class="logo d-flex align-items-center mb-4">
                        <span class="sitename">TravelTime</span>
                    </a>
                    <p class="mb-4">Oferim experiențe de călătorie de neuitat și servicii personalizate pentru fiecare aventură. Echipa noastră este dedicată confortului și siguranței tale.</p>

                    <div class="newsletter-form">
                        <h5>Abonează-te</h5>
                        <form action="forms/newsletter.php" method="post" class="php-email-form">
                            <div class="input-group">
                                <input type="email" name="email" class="form-control" placeholder="Introdu adresa ta de email" required="">
                                <button type="submit" class="btn-subscribe">
                                    <i class="bi bi-send"></i>
                                </button>
                            </div>
                            <div class="loading">Se încarcă</div>
                            <div class="error-message"></div>
                            <div class="sent-message">Mulțumim pentru abonare!</div>
                        </form>
                    </div>
                </div>
            </div>

            <div class="col-lg-2 col-6">
                <div class="footer-links">
                    <h4>Companie</h4>
                    <ul>
                        <li><a href="#"><i class="bi bi-chevron-right"></i> Despre Noi</a></li>
                        <li><a href="#"><i class="bi bi-chevron-right"></i> Cariere</a></li>
                        <li><a href="#"><i class="bi bi-chevron-right"></i> Presă</a></li>
                        <li><a href="#"><i class="bi bi-chevron-right"></i> Blog</a></li>
                        <li><a href="#"><i class="bi bi-chevron-right"></i> Contact</a></li>
                    </ul>
                </div>
            </div>

            <div class="col-lg-2 col-6">
                <div class="footer-links">
                    <h4>Soluții</h4>
                    <ul>
                        <li><a href="#"><i class="bi bi-chevron-right"></i> Strategie Digitală</a></li>
                        <li><a href="#"><i class="bi bi-chevron-right"></i> Cloud Computing</a></li>
                        <li><a href="#"><i class="bi bi-chevron-right"></i> Analiză Date</a></li>
                        <li><a href="#"><i class="bi bi-chevron-right"></i> Soluții AI</a></li>
                        <li><a href="#"><i class="bi bi-chevron-right"></i> Securitate Cibernetică</a></li>
                    </ul>
                </div>
            </div>

            <div class="col-lg-4">
                <div class="footer-contact">
                    <h4>Contactează-ne</h4>
                    <div class="contact-item">
                        <div class="contact-icon">
                            <i class="bi bi-geo-alt"></i>
                        </div>
                        <div class="contact-info">
                            <p>2847 Maple Avenue<br>Los Angeles, CA 90210<br>Statele Unite</p>
                        </div>
                    </div>

                    <div class="contact-item">
                        <div class="contact-icon">
                            <i class="bi bi-telephone"></i>
                        </div>
                        <div class="contact-info">
                            <p>+1 (555) 987-6543</p>
                        </div>
                    </div>

                    <div class="contact-item">
                        <div class="contact-icon">
                            <i class="bi bi-envelope"></i>
                        </div>
                        <div class="contact-info">
                            <p>contact@example.com</p>
                        </div>
                    </div>

                    <div class="social-links">
                        <a href="#"><i class="bi bi-facebook"></i></a>
                        <a href="#"><i class="bi bi-twitter-x"></i></a>
                        <a href="#"><i class="bi bi-linkedin"></i></a>
                        <a href="#"><i class="bi bi-youtube"></i></a>
                        <a href="#"><i class="bi bi-github"></i></a>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <div class="footer-bottom">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-lg-6">
                    <div class="copyright">
                        <p>© <span>Drepturi de autor</span> <strong class="px-1 sitename">MyWebsite</strong> <span>Toate drepturile rezervate</span></p>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="footer-bottom-links">
                        <a href="#">Politica de Confidențialitate</a>
                        <a href="#">Termeni și Condiții</a>
                        <a href="#">Politica Cookie</a>
                    </div>
                    <div class="credits">
                    </div>
                </div>
            </div>
        </div>
    </div>

</footer>

<!-- Scroll Top -->
<a href="#" id="scroll-top" class="scroll-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

<!-- Preloader -->
<!--<div id="preloader"></div>-->
<!-- Main JS File -->



<!-- Login Modal -->
<div class="modal fade" id="loginModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Welcome Back!</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <div class="modal-body">
                <form th:action="@{/auth/login}" method="post">

                    <div class="mb-3">
                        <label class="form-label">Email or Username</label>
                        <div class="input-group">
                            <input type="text" class="form-control" name="usernameOrEmail" placeholder="Enter your email or username" required>
                            <span class="input-group-text"><i class="fas fa-user"></i></span>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Password</label>
                        <div class="input-group">
                            <input type="password" class="form-control" name="password" placeholder="Enter your password" required>
                            <span class="input-group-text"><i class="fas fa-eye"></i></span>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-login w-100">Sign In</button>

                    <div class="register-link mt-3 text-center">
                        Don't have an account?
                        <a href="#" data-bs-toggle="modal" data-bs-target="#registerModal" data-bs-dismiss="modal">
                            Register now
                        </a>
                    </div>
                </form>
            </div>

        </div>
    </div>
</div>


<!--register modal-->
<div class="modal fade" id="registerModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Register</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form action="/auth/register" method="post">

                    <div class="mb-3">
                        <label class="form-label">Your Name</label>
                        <input type="text" class="form-control" name="username" placeholder="Your name" required>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Email address</label>
                        <input type="email" class="form-control" name="email" placeholder="name@example.com" required>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Password</label>
                        <input type="password" class="form-control" name="password_hash" placeholder="Password" required>
                    </div>
                    <div class="form-check mt-3">
                        <input class="form-check-input" type="checkbox" id="isGuide" name="isGuide" value="true">
                        <label class="form-check-label" for="isGuide">
                            Sunt ghid
                        </label>
                    </div>

                    <button type="submit" class="btn btn-login">Register</button>

                    <div class="divider mt-3"><span>or sign up with</span></div>

                    <div class="social-login mt-2">
                        <button type="button" class="btn btn-social">
                            <i class="fab fa-google"></i> Google
                        </button>
                        <button type="button" class="btn btn-social">
                            <i class="fab fa-facebook-f"></i> Facebook
                        </button>
                    </div>

                </form>
            </div>
        </div>
    </div>
</div>

<!-- Avatar Select Modal -->
<div class="modal fade" id="avatarModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">

            <div class="modal-header">
                <h5 class="modal-title">Choose Your Avatar</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <div class="modal-body">
                <div class="row text-center">

                    <!-- 12 avataruri -->
                    <div class="col-3 mb-4" th:each="i : ${#numbers.sequence(1,12)}">
                        <label style="cursor:pointer; display:inline-block; position:relative;">
                            <input type="radio" name="avatar"
                                   th:value="'avatar' + ${i}"
                                   class="form-check-input"
                                   style="opacity:0; position:absolute; left:0; top:0; width:100%; height:100%; cursor:pointer;">

                            <img th:src="@{'https://api.dicebear.com/9.x/dylan/svg?seed=avatar' + ${i}}"
                                 class="rounded-circle border avatar-option"
                                 width="90" height="90">
                        </label>
                    </div>

                </div>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="saveAvatarBtn">Save Avatar</button>
            </div>
        </div>
    </div>
</div>
<form id="avatarForm" th:action="@{/profile/avatar}" method="post" style="display:none">
    <input type="hidden" name="avatar" id="avatarValue"/>
    <!-- CSRF doar dacă există -->
    <input th:if="${_csrf != null}" type="hidden"
           th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
</form>
<!-- JS -->
<!-- src/main/resources/templates/layout.html -->
<!-- Înlocuiește blocul <script> pentru avatar cu acesta -->
<script>
    (function () {
        const avatarImgs = document.querySelectorAll('.avatar-option');
        const saveBtn = document.getElementById('saveAvatarBtn');
        const form = document.getElementById('avatarForm');
        const avatarValue = document.getElementById('avatarValue');

        // select vizual + radio hidden
        avatarImgs.forEach(img => {
            img.addEventListener('click', function () {
                avatarImgs.forEach(i => i.classList.remove('selected'));
                this.classList.add('selected');
                this.previousElementSibling.checked = true; /* WHY: radio-ul din label trebuie să aibă value */
            });
        });

        // la Save -> persistă în DB; redirectul aduce avatarul nou din model (${user.avatar})
        saveBtn?.addEventListener('click', function () {
            const selected = document.querySelector('input[name="avatar"]:checked');
            if (!selected) { alert('Please select an avatar!'); return; }

            avatarValue.value = selected.value;  /* WHY: controllerul primește parametrul "avatar" */
            form.submit();                       /* WHY: @PostMapping("/profile/avatar") salvează + redirect */
        });
    })();
</script>
<script>
    (function() {
        const toggleBtn = document.getElementById('themeToggle');
        if (!toggleBtn) return;
        const icon = toggleBtn.querySelector('i');
        const THEME_KEY = 'theme';

        function apply(theme) {
            const dark = theme === 'dark';
            document.body.classList.toggle('dark-background', dark);
            // iconița reprezintă TEMA CURENTĂ: soare pe light, lună pe dark
            if (icon) icon.className = dark ? 'bi bi-moon' : 'bi bi-sun';
            toggleBtn.setAttribute('aria-pressed', String(dark));
            toggleBtn.title = dark ? 'Dark mode' : 'Light mode';
        }

        // init: din localStorage sau preferința OS
        const stored = localStorage.getItem(THEME_KEY);
        const prefersDark = window.matchMedia?.('(prefers-color-scheme: dark)').matches;
        apply(stored ?? (prefersDark ? 'dark' : 'light'));

        // toggle + persist
        toggleBtn.addEventListener('click', () => {
            const dark = document.body.classList.contains('dark-background');
            const next = dark ? 'light' : 'dark';
            localStorage.setItem(THEME_KEY, next);
            apply(next);
        });
    })();
</script>
<script th:src="@{/vendor/bootstrap/js/bootstrap.bundle.min.js}"></script>
<script th:src="@{/js/main.js}"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const img = document.querySelector('.right-user img.js-avatar-trigger');
        if (!img) return;
        img.addEventListener('click', function (ev) {
            // Nu deschide dropdown-ul, ci avatar modalul
            ev.preventDefault();
            ev.stopPropagation();
            const modalEl = document.getElementById('avatarModal');
            if (!modalEl) return;
            const modal = new bootstrap.Modal(modalEl);
            modal.show();
        });
    });
</script>
<script defer>
    (function () {
        const item   = document.querySelector('#header .account-item');
        const toggle = item?.querySelector('.account-toggle');

        // Deschide/închide meniul la click pe "Cont"
        toggle?.addEventListener('click', function (e) {
            e.preventDefault();
            e.stopPropagation();
            item.classList.toggle('open');
        });

        // Închide când dai click în afara meniului
        document.addEventListener('click', function (e) {
            if (!item) return;
            if (!item.contains(e.target)) item.classList.remove('open');
        });

        // Închide la ESC
        document.addEventListener('keydown', function (e) {
            if (e.key === 'Escape') item?.classList.remove('open');
        });
    })();
</script>

<script>
const chatBox = document.getElementById('chat-box');
const chatInput = document.getElementById('chat-input');
const chatMessages = document.getElementById('chat-messages');
const openChatButton = document.getElementById('open-chat');
const closeChatButton = document.getElementById('close-chat');

// Preluare nume user
const usernameEl = document.getElementById('chat-username');
const username = usernameEl ? usernameEl.textContent.trim() : 'User';

// Deschidere chat
openChatButton.addEventListener('click', () => {
chatBox.style.display = 'flex';

// Adaugă mesaj de bun venit doar prima dată
if(!chatBox.dataset.welcomeShown) {
addMessage('Expert', `Bine ai venit, ${username}! Cu ce te pot ajuta?`);
chatBox.dataset.welcomeShown = true;
}
});

// Închidere chat
closeChatButton.addEventListener('click', () => {
chatBox.style.display = 'none';
});

// Adaugă mesaj în chat
function addMessage(sender, text) {
const msgDiv = document.createElement('div');
msgDiv.textContent = text;

if(sender === 'Tu') {
msgDiv.classList.add('user-msg');
} else {
msgDiv.classList.add('expert-msg');
}

chatMessages.appendChild(msgDiv);
chatMessages.scrollTop = chatMessages.scrollHeight;
}

// Trimite mesaj la Enter
chatInput.addEventListener('keypress', async function(e){
if(e.key === 'Enter' && chatInput.value.trim() !== '') {
const message = chatInput.value.trim();
addMessage('Tu', message);
chatInput.value = '';

const tempId = 'temp-' + Date.now();
const tempDiv = document.createElement('div');
tempDiv.id = tempId;
tempDiv.textContent = '...';
tempDiv.classList.add('expert-msg');
chatMessages.appendChild(tempDiv);
chatMessages.scrollTop = chatMessages.scrollHeight;

try {
const response = await fetch('http://localhost:8080/api/chat', {
method: 'POST',
headers: { 'Content-Type': 'application/json' },
body: JSON.stringify({ message })
});

const data = await response.json();
tempDiv.textContent = data.reply;
} catch (err) {
tempDiv.textContent = 'Îmi pare rău, a apărut o eroare.';
console.error(err);
}
}
});
</script>






</body>
</html>
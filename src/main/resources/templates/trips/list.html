<!DOCTYPE html>
<html lang="ro"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
  <title>Itinerariile mele</title>
</head>

<div layout:fragment="content">

  <!-- HERO -->
  <div class="page-title dark-background"
       th:style="|background-image: url('@{/walpaper/showcase-11.webp}');|">
    <div class="container position-relative">
      <h1>Itinerarii</h1>
      <p>Creează momente memorabile cu noi.</p>
    </div>
  </div>

  <section class="container py-5">

    <!-- BARA DE CATEGORII + CTA -->
    <div class="chips-wrapper">
      <div class="chips">
        <!-- afișate permanent -->
        <button class="chip is-active" type="button" data-filter="all">All</button>
        <button class="chip" type="button" data-filter="city_break">City break</button>
        <button class="chip" type="button" data-filter="adventure">Aventură</button>
        <button class="chip" type="button" data-filter="business">Business</button>
        <button class="chip" type="button" data-filter="relax">Relaxare</button>

        <!-- CTA pe alb -->
        <a class="chip chip--cta ms-auto" th:href="@{/trips/new}">+ Creează itinerariu</a>
      </div>
    </div>

    <!-- Mesaj fără rezultate -->
    <div id="noResults" class="alert alert-info d-none mt-4">
      Nu există un itinerariu în această categorie.
    </div>

    <!-- LISTA CA R D U R I -->
    <div class="row g-4 mt-2">
      <div class="col-12" th:if="${#lists.isEmpty(trips)}">
        <div class="alert alert-info">Încă nu ai niciun itinerariu. Creează unul nou.</div>
      </div>

      <div class="col-md-6"
           th:each="t : ${trips}"
           th:with="cat=${#strings.toLowerCase(t.category)}">

        <div class="trip-card card h-100 shadow-sm"
             th:attr="data-category=${cat}">
          <div class="card-body p-4 position-relative">
            <!-- badge categorie -->
            <span class="trip-card__badge"
                  th:text="${t.category}">CITY_BREAK</span>

            <h3 class="trip-card__title mb-1">
              <a th:href="@{|/trips/${t.id}|}" th:text="${t.title}">Titlu</a>
            </h3>

            <div class="text-muted mb-3 d-flex align-items-center gap-2">
              <i class="bi bi-calendar2-week"></i>
              <span th:text="${t.startDate}">2025-01-01</span>
              <span>–</span>
              <span th:text="${t.endDate}">2025-01-05</span>
            </div>

            <p class="mb-4" th:text="${t.description}">—</p>

            <div class="d-flex gap-2">
              <a class="btn btn-outline-secondary" th:href="@{|/trips/${t.id}|}">Vezi</a>
              <a class="btn btn-outline-primary" th:href="@{|/trips/${t.id}/edit|}">Editează</a>

              <form th:action="@{|/trips/${t.id}/delete|}" method="post" class="ms-auto"
                    onsubmit="return confirm('Ștergi acest itinerariu?');">
                <input th:if="${_csrf != null}" type="hidden"
                       th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                <button type="submit" class="btn btn-outline-danger">Șterge</button>
              </form>
            </div>
          </div>
        </div>

      </div>
    </div>
  </section>

  <!-- Stilurile chips + card (efecte ca în Destinations) -->
  <style>
    .chips-wrapper{
      display:flex;
      justify-content:center;
      margin-top:-40px;
    }
    .chips{
      display:flex;
      align-items:center;
      gap:22px;
      background:#fff;
      border-radius:999px;
      padding:14px 18px;
      box-shadow:
              0 10px 30px rgba(0,0,0,.06),
              0 2px 10px rgba(0,0,0,.04);
      position:relative;
      overflow:hidden;
    }
    .chip{
      appearance:none;
      border:0;
      background:transparent;
      padding:12px 22px;
      border-radius:999px;
      font-weight:600;
      line-height:1;
      cursor:pointer;
      transition:transform .18s ease, box-shadow .18s ease, color .18s ease, background .18s ease;
      color:#6b7280; /* text gri ca în Destinations */
      text-decoration:none;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      white-space:nowrap;
    }
    .chip:hover,
    .chip:focus{
      transform:translateY(-1px);
      color:#111827;
    }
    .chip.is-active{
      background:#e66450; /* accent ca în exemplu */
      color:#fff;
      box-shadow:0 10px 24px rgba(230,100,80,.35);
    }

    /* CTA pe alb, text vizibil mereu */
    .chip--cta{
      margin-left:auto;
      background:#fff;
      border:1px solid rgba(0,0,0,.08);
      box-shadow:0 8px 24px rgba(0,0,0,.08);
    }
    .chip--cta,
    .chip--cta:link,
    .chip--cta:visited{
      color:#e66450 !important;
      font-weight:700;
    }
    .chip--cta:hover,
    .chip--cta:focus{
      background:#fff;
      color:#e66450 !important;
      transform:translateY(-1px);
      box-shadow:0 12px 36px rgba(0,0,0,.14);
      text-decoration:none;
    }
    body.dark-background .chips{
      background:#111827;
      box-shadow:0 10px 30px rgba(0,0,0,.5);
    }
    body.dark-background .chip{
      color:#cbd5e1;
    }
    body.dark-background .chip.is-active{
      background:#e66450;
      box-shadow:0 10px 24px rgba(230,100,80,.25);
      color:#fff;
    }
    body.dark-background .chip:hover{ color:#fff; }
    body.dark-background .chip--cta{
      background:#fff;
      border-color:rgba(255,255,255,.25);
    }

    /* Card */
    /* Card – fără padding-top aici */
    .trip-card{
      position: relative;
      border-radius: 20px;
      overflow: hidden;
      background: #ffffff;
      transition: transform .2s ease, box-shadow .2s ease;
      box-shadow: 0 4px 10px rgba(0,0,0,.1);
    }

    .trip-card:hover {
      transform: scale(1.05);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      z-index: 2;
    }

    /* Badge fix în colțul cardului */
    .trip-card__badge{
      position: absolute;
      top: 16px;
      right: 16px;
      left: auto;
      background: #ff6b6b;
      color: #fff;
      font-size: .875rem;
      padding: 5px 10px;
      border-radius: 12px;
      box-shadow: 0 2px 5px rgba(0,0,0,.2);
      z-index: 3;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* REZERVĂ loc pentru badge în interiorul conținutului cardului */
    .trip-card .card-body{
      padding-top: 64px;   /* ~ 16(top) + ~32(înălțime badge) + puțin aer */
    }

    /* opțional – anulează marja default a titlului dacă vrei mai compact */
    .trip-card__title{ margin-top: 0; }
    .trip-card__title a{ color:#e66450; text-decoration:none; }
    .trip-card__title a:hover{ text-decoration:underline; }




    body.dark-background .trip-card{ border-color:rgba(255,255,255,.08); }
    body.dark-background .trip-card__badge{ background:#1f2937; color:#e5e7eb; }

  </style>

  <!-- JS filtrare client-side -->
  <script>
    (function () {
      const chips = Array.from(document.querySelectorAll('[data-filter]'));
      const cards = Array.from(document.querySelectorAll('[data-category]'));
      const noRes = document.getElementById('noResults');

      function applyFilter(filter){
        // toggle chip activ
        chips.forEach(c => c.classList.toggle('is-active', c.dataset.filter === filter));

        let any = false;
        cards.forEach(card => {
          const cat = (card.dataset.category || '').toLowerCase();
          const show = (filter === 'all') || (cat === filter);
          card.closest('.col-md-6').classList.toggle('d-none', !show);
          if (show) any = true;
        });

        if (noRes) noRes.classList.toggle('d-none', any);

        // pune filtrul în URL (fără reload)
        const url = new URL(window.location);
        if (filter === 'all') url.searchParams.delete('cat');
        else url.searchParams.set('cat', filter);
        history.replaceState(null, '', url);
      }

      // click pe chip
      document.addEventListener('click', (e) => {
        const chip = e.target.closest('[data-filter]');
        if (!chip) return;
        e.preventDefault();
        applyFilter(chip.dataset.filter);
      });

      // init din ?cat=...
      const param = new URLSearchParams(window.location.search).get('cat');
      const initial = (param || 'all').toLowerCase();
      applyFilter(initial);
    })();
  </script>

</div>
</html>

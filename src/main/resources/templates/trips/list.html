<!DOCTYPE html>
<html lang="ro"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
  <title>Itinerariile mele</title>
</head>

<div layout:fragment="content">

  <!-- HERO -->
  <div class="page-title dark-background"
       th:style="|background-image: url('@{/walpaper/showcase-11.webp}');|">
    <div class="container position-relative">
      <h1>Itinerarii</h1>
      <p>Planifică, organizează și păstrează amintirile.</p>
    </div>
  </div>

  <section class="container py-5">

    <!-- BARA DE CATEGORII + CTA -->
    <div class="chips-wrapper">
      <div class="chips">
        <button class="chip is-active" type="button" data-filter="all">Toate</button>
        <button class="chip" type="button" data-filter="city_break">City break</button>
        <button class="chip" type="button" data-filter="adventure">Aventură</button>
        <button class="chip" type="button" data-filter="business">Business</button>
        <button class="chip" type="button" data-filter="relax">Relaxare</button>

        <a class="chip chip--cta ms-auto" th:href="@{/trips/new}">+ Creează itinerariu</a>
      </div>
    </div>

    <!-- Mesaj fără rezultate -->
    <div id="noResults" class="alert alert-info d-none mt-4">
      Nu există un itinerariu în această categorie.
    </div>

    <!-- LISTA CARDURI -->
    <div class="row g-4 mt-2">
      <div class="col-12" th:if="${#lists.isEmpty(trips)}">
        <div class="alert alert-info">Încă nu ai niciun itinerariu. Creează unul nou.</div>
      </div>

      <div class="col-md-6"
           th:each="t : ${trips}"
           th:with="cat=${#strings.toLowerCase(t.category)},
                    coverUrl=${coverUrlByTripId[t.id]}">

        <div class="trip-card card h-100 shadow-sm"
             th:attr="data-category=${cat}">

          <!-- ✅ Imagine copertă (difuz) -->
          <div class="trip-card__media"
               th:style="|background-image: url('${coverUrl}');|">

            <div class="trip-card__media-gradient"></div>

            <!-- ✅ Upload copertă (POST clasic + redirect) -->
            <form class="trip-card__cover-form"
                  th:action="@{|/trips/${t.id}/cover|}"
                  method="post"
                  enctype="multipart/form-data">
              <input th:if="${_csrf != null}" type="hidden"
                     th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

              <input class="trip-card__cover-input"
                     type="file"
                     th:id="${'cover-' + t.id}"
                     name="cover"
                     accept="image/*"/>

              <label class="trip-card__cover-btn" th:for="${'cover-' + t.id}">
                <i class="bi bi-image"></i> Copertă
              </label>

              <button class="trip-card__cover-save" type="submit" disabled>
                Salvează
              </button>
            </form>
          </div>

          <div class="card-body p-4 position-relative">
            <span class="trip-card__badge" th:text="${t.category}">CITY_BREAK</span>

            <h3 class="trip-card__title mb-1">
              <a th:href="@{|/trips/${t.id}|}" th:text="${t.title}">Titlu</a>
            </h3>

            <div class="text-muted mb-3 d-flex align-items-center gap-2">
              <i class="bi bi-calendar2-week"></i>
              <span th:text="${t.startDate}">2025-01-01</span>
              <span>–</span>
              <span th:text="${t.endDate}">2025-01-05</span>
            </div>

            <p class="mb-4" th:text="${t.description}">—</p>

            <div class="d-flex gap-2">
              <a class="btn btn-outline-secondary" th:href="@{|/trips/${t.id}|}">Vezi</a>
              <a class="btn btn-outline-primary" th:href="@{|/trips/${t.id}/edit|}">Editează</a>

              <form th:action="@{|/trips/${t.id}/delete|}" method="post" class="ms-auto"
                    onsubmit="return confirm('Ștergi acest itinerariu?');">
                <input th:if="${_csrf != null}" type="hidden"
                       th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                <button type="submit" class="btn btn-outline-danger">Șterge</button>
              </form>
            </div>
          </div>
        </div>

      </div>
    </div>
  </section>

  <style>
    .chips-wrapper{display:flex;justify-content:center;margin-top:-40px;}
    .chips{display:flex;align-items:center;gap:22px;background:#fff;border-radius:999px;padding:14px 18px;box-shadow:0 10px 30px rgba(0,0,0,.06),0 2px 10px rgba(0,0,0,.04);position:relative;overflow:hidden;}
    .chip{appearance:none;border:0;background:transparent;padding:12px 22px;border-radius:999px;font-weight:600;line-height:1;cursor:pointer;transition:transform .18s ease, box-shadow .18s ease, color .18s ease, background .18s ease;color:#6b7280;text-decoration:none;display:inline-flex;align-items:center;justify-content:center;white-space:nowrap;}
    .chip:hover,.chip:focus{transform:translateY(-1px);color:#111827;}
    .chip.is-active{background:#e66450;color:#fff;box-shadow:0 10px 24px rgba(230,100,80,.35);}
    .chip--cta{margin-left:auto;background:#fff;border:1px solid rgba(0,0,0,.08);box-shadow:0 8px 24px rgba(0,0,0,.08);}
    .chip--cta,.chip--cta:link,.chip--cta:visited{color:#e66450 !important;font-weight:700;}
    .chip--cta:hover,.chip--cta:focus{background:#fff;color:#e66450 !important;transform:translateY(-1px);box-shadow:0 12px 36px rgba(0,0,0,.14);text-decoration:none;}

    .trip-card{position:relative;border-radius:20px;overflow:hidden;background:#fff;transition:transform .2s ease, box-shadow .2s ease;box-shadow:0 4px 10px rgba(0,0,0,.1);}
    .trip-card:hover{transform:scale(1.03);box-shadow:0 10px 30px rgba(0, 0, 0, 0.25);z-index:2;}

    /* ✅ MEDIA (copertă difuză) */
    .trip-card__media{
      position: relative;
      height: 160px;
      background-size: cover;
      background-position: center;
      overflow: hidden;
    }
    .trip-card__media::before{
      filter: none;
      opacity: 1;
      transform: none;
    }
    .trip-card__media-gradient{
      background: linear-gradient(to bottom, rgba(0,0,0,.10), rgba(0,0,0,.45));
    }

    /* ✅ Form upload copertă (top-left) */
    .trip-card__cover-form{
      position:absolute;
      top: 12px;
      left: 12px;
      z-index: 2;
      display:flex;
      gap: 8px;
      align-items:center;
    }
    .trip-card__cover-input{ display:none; }
    .trip-card__cover-btn{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding: 7px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.9);
      color: #111827;
      font-weight: 700;
      font-size: 12px;
      cursor:pointer;
      border: 1px solid rgba(0,0,0,.08);
      text-decoration:none;
      transition: transform .18s ease, box-shadow .18s ease;
    }
    .trip-card__cover-btn:hover{ transform: translateY(-1px); box-shadow: 0 10px 22px rgba(0,0,0,.12); }
    .trip-card__cover-save{
      padding: 7px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.25);
      background: rgba(230,100,80,.95);
      color:#fff;
      font-weight: 800;
      font-size: 12px;
      cursor:pointer;
      opacity: .65;
      transition: opacity .18s ease, transform .18s ease;
    }
    .trip-card__cover-save:disabled{ cursor:not-allowed; }
    .trip-card__cover-save:not(:disabled){ opacity: 1; }
    .trip-card__cover-save:not(:disabled):hover{ transform: translateY(-1px); }

    /* Badge */
    .trip-card__badge{position:absolute;top:16px;right:16px;background:#ff6b6b;color:#fff;font-size:.875rem;padding:5px 10px;border-radius:12px;box-shadow:0 2px 5px rgba(0,0,0,.2);z-index:3;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
    .trip-card .card-body{padding-top:64px;}
    .trip-card__title{margin-top:0;}
    .trip-card__title a{color:#e66450;text-decoration:none;}
    .trip-card__title a:hover{text-decoration:underline;}
  </style>

  <script>
    // Filtrare client-side (chip-uri)
    (function () {
      const chips = Array.from(document.querySelectorAll('[data-filter]'));
      const cards = Array.from(document.querySelectorAll('[data-category]'));
      const noRes = document.getElementById('noResults');

      function applyFilter(filter){
        chips.forEach(c => c.classList.toggle('is-active', c.dataset.filter === filter));

        let any = false;
        cards.forEach(card => {
          const cat = (card.dataset.category || '').toLowerCase();
          const show = (filter === 'all') || (cat === filter);
          card.closest('.col-md-6').classList.toggle('d-none', !show);
          if (show) any = true;
        });

        if (noRes) noRes.classList.toggle('d-none', any);

        const url = new URL(window.location);
        if (filter === 'all') url.searchParams.delete('cat');
        else url.searchParams.set('cat', filter);
        history.replaceState(null, '', url);
      }

      chips.forEach(btn => {
        btn.addEventListener('click', () => applyFilter(btn.dataset.filter));
      });
    })();

    // ✅ Enable "Salvează" doar când alegi o imagine
    (function () {
      document.querySelectorAll('.trip-card__cover-input').forEach(input => {
        input.addEventListener('change', () => {
          const form = input.closest('form');
          const btn = form ? form.querySelector('.trip-card__cover-save') : null;
          if (btn) btn.disabled = !(input.files && input.files.length);
        });
      });
    })();
  </script>

</div>
</html>
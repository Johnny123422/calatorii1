<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      layout:decorate="~{layout}">

<div class="content-wrapper" layout:fragment="content">
    <!--Page Title-->
    <div class="page-title dark-background" th:style="|background-image: url('@{/walpaper/showcase-7.webp}');|">
        <div class="container position-relative">
            <h1>Bun venit pe ITravel</h1>
            <p>Acesta este profilul tÄƒu.</p>

        </div>
    </div> <!--End Page Title-->
    <style>
        .profile-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-areas:
                "avatar info"
                "tours tours";/* douÄƒ coloane egale */
            max-width: 1200px; /* le È›inem Ã®nguste È™i elegante */
            margin: 0 auto; /* centrare pe paginÄƒ */
            gap: 30px; /* distanÈ›Äƒ frumoasÄƒ Ã®ntre carduri */
            padding: 20px;
        }

        .profile-avatar{
            grid-area: avatar;
        }
        .profile-info{
            grid-area: info;
        }
        .list_tours{
            grid-area: tours;
        }

        .profile-avatar,
        .profile-info {
            background: var(--surface-color);
            border-radius: 10px;
            border: 1px solid rgba(0,0,0,0.1);
            padding: 30px 40px; /* spatiu mai bun L-R */
            transition: all 0.3s ease;
            box-sizing: border-box;
            text-align: center; /* center pentru titluri & text simplu */
        }

        /* fix pentru lista din profile-info */
        .profile-info ul {
            list-style: none;        /* scoate bullet-urile */
            padding: 0;
            margin: 0;
        }

        .profile-info ul li {
            text-align: center;      /* alineazÄƒ fiecare item */
            margin-bottom: 8px;      /* spacing frumos */
        }
        .profile-avatar,
        .profile-info ,
        .leaderboard,
        .purchase-list,
        .destination-card,
        .journal-card{
            background: var(--surface-color);
            border-radius: 10px;
            border: 1px solid rgba(0,0,0,0.1);
            padding: 30px;
            transition: all 0.3s ease;
            box-sizing: border-box;
        }

        /* Hover effect */
        .profile-avatar:hover,
        .profile-info:hover ,
        .leaderboard:hover,
        .purchase-list:hover,
        .destination-card:hover,
        .journal-card:hover{
            transform: translateY(-8px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
            border-color: rgba(0,0,0,0.2);
        }

        .leaderboard-row.me {
            background: linear-gradient(90deg, #ffe066, #ffcc00);
            animation: glow 1.5s ease-in-out infinite alternate;
            font-weight: bold;
            border-radius: 8px;
        }

        @keyframes glow {
            from {
                box-shadow: 0 0 5px #ffea70;
            }
            to {
                box-shadow: 0 0 20px #ffd60a;
            }
        }

        .profile-sections{
            display:grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }


        /* Cardul Jurnal â€“ ocupÄƒ ambele coloane, colaj stÃ¢nga + text dreapta */
        .journal-card{
            grid-column: span 2;
            display:flex;
            align-items:center;
            gap: 20px;
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }

        /* Colajul rÄƒmÃ¢ne ca Ã®nainte */
        .journal-collage{
            display:grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: 1fr 1fr;
            grid-template-areas:
    "A B"
    "C D";
            gap: 8px;
            width: 190px;
            height: 120px;
            flex: 0 0 auto;
        }

        .journal-collage > img:nth-child(1){ grid-area: A; }
        .journal-collage > img:nth-child(2){ grid-area: B; }
        .journal-collage > img:nth-child(3){ grid-area: C; }
        .journal-collage > img:nth-child(4){ grid-area: D; }

        .journal-collage > img{
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 14px;
            transition: transform .25s ease, filter .25s ease;
        }

        /* Mobile: ca Ã®nainte */
        @media(max-width: 992px){
            .profile-sections{ grid-template-columns: 1fr; }
            .journal-card{ grid-column: span 1; flex-direction: column; align-items: stretch; }
            .journal-collage{ width: 100%; height: 160px; }
        }

        /* === SKIN PREMIUM (NU schimbÄƒ layout-ul) === */
        .journal-card--premium{
            border-radius: 20px;
            background: rgba(255,255,255,.92);
            border: 1px solid rgba(0,0,0,.06);
            box-shadow: 0 12px 40px rgba(0,0,0,0.12);
            transition: transform .25s ease, box-shadow .25s ease, border-color .25s ease;
            padding: 18px;
        }

        .journal-card--premium:hover{
            transform: translateY(-4px);
            box-shadow: 0 20px 55px rgba(0,0,0,0.22);
            border-color: rgba(230,100,80,.25);
        }

        .journal-card--premium::before{
            content:"";
            position:absolute;
            inset:0;
            background: radial-gradient(circle at 15% 15%, rgba(230,100,80,.14), transparent 55%),
            radial-gradient(circle at 90% 75%, rgba(0,0,0,.06), transparent 55%);
            pointer-events:none;
        }

        /* mai â€œcrispyâ€ fÄƒrÄƒ sÄƒ schimbe mÄƒrimile */
        .journal-card--premium .journal-collage > img{
            filter: saturate(.92) contrast(1.03);
        }


        .xp-container {
            width: 100%;
            max-width: 220px;
            margin: 10px auto 0;
        }

        .xp-text {
            text-align: center;
        }

        .xp-bar {
            width: 100%;
            height: 10px;
            background: #e5e7eb;
            border-radius: 999px;
            overflow: hidden;
            margin-top: 6px;
        }

        .xp-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #6366f1, #22c55e);
            border-radius: 999px;
            transition: width 0.4s ease;
        }

    </style>
<div class="profile-container">
    <!-- AVATAR (premium) -->
    <div class="profile-avatar premium-panel">
        <div class="premium-panel__head">
            <div class="premium-panel__title">
                <span class="premium-panel__icon"><i class="bi bi-person-circle"></i></span>
                <div>
                    <h5 class="m-0">Profil</h5>
                    <small class="text-muted">Avatar È™i nivel</small>
                </div>
            </div>
        </div>

        <div class="premium-panel__body premium-panel__body--center">
            <div class="avatar-container me-2"
                 data-bs-toggle="modal"
                 data-bs-target="#avatarModal"
                 style="cursor: pointer; position: relative; display:inline-block;">

                <img th:src="@{'https://api.dicebear.com/9.x/personas/svg?seed=' + ${user.avatar}}"
                     alt="Avatar"
                     class="avatar"
                     th:classappend="${navbarLevelClass}">

                <img th:if="${navbarFrameGif != null}"
                     th:src="@{${navbarFrameGif}}"
                     class="avatar-frame">

                <span id="navbar-points"
                      sec:authorize="hasRole('User') and !hasRole('Guide')"
                      class="badge points"
                      th:utext="${navbarPoints} + ' <i class=\'fa-regular fa-money-bill-1\'></i>'">
        </span>

                <span class="badge level"
                      sec:authorize="isAuthenticated()"
                      th:text="'Lvl ' + ${navbarLevel}"></span>

                <span class="badge role User"
                      sec:authorize="hasRole('User') and !hasRole('Guide')">
          <i class="bi bi-person-fill"></i> Utilizator
        </span>

                <span class="badge role Guide"
                      sec:authorize="hasRole('Guide')">
          <i class="bi bi-geo-alt-fill"></i> Ghid
        </span>
            </div>

            <h4 class="mt-3 mb-0" th:text="${user.username}">Nume utilizator</h4>
            <p class="text-muted mb-0 mt-1 small">ApasÄƒ pe avatar pentru a-l schimba</p>

        </div>

        <!-- ðŸ”¥ XP BAR (gaming style) -->
        <div class="xp-container">
            <div class="xp-text text-muted small">
                XP: <span th:text="${navbarXp}">0</span> /
                <span th:text="${navbarXpNeeded}">100</span>
            </div>

            <div class="xp-bar">
                <div class="xp-bar-fill"
                     th:style="'width:' + ${navbarXpPercent} + '%'">
                </div>
            </div>
        </div>

    </div>


    <!-- INFO PROFIL (premium) -->
    <div class="profile-info premium-panel">
        <div class="premium-panel__head">
            <div class="premium-panel__title">
                <span class="premium-panel__icon"><i class="bi bi-info-circle"></i></span>
                <div>
                    <h5 class="m-0">InformaÈ›ii profil</h5>
                    <small class="text-muted">Datele contului</small>
                </div>
            </div>
        </div>

        <div class="premium-panel__body">
            <ul class="profile-info-list">
                <li class="profile-info-row">
                    <i class="bi bi-envelope"></i>
                    <span><strong>Email:</strong> <span th:text="${user.email}">email@example.com</span></span>
                </li>

                <li class="profile-info-row">
                    <i class="bi bi-clock-history"></i>
                    <span><strong>Creat la:</strong> <span th:text="${user.createdAt}">2025-01-01</span></span>
                </li>
            </ul>
        </div>
    </div>
    <!-- Jurnalul meu â€“ card banner orizontal -->
    <div sec:authorize="hasRole('User') and !hasRole('Guide')" class="journal-card journal-card--premium">
        <div class="journal-collage">
            <img th:src="@{/uploads/1765640169105_Croatia.webp}" alt="">
            <img th:src="@{/uploads/1765593380215_germania.jpg}" alt="">
            <img th:src="@{/uploads/1765594353762_san-francisco-sua.webp}" alt="">
            <img th:src="@{/uploads/1765820566065_florence.jpg}" alt="">
        </div>

        <div>
            <h4 class="mb-1">Jurnalul meu</h4>
            <p class="text-muted mb-0">SalveazÄƒ amintiri din excursii.</p>
        </div>

        <a class="stretched-link" th:href="@{/journal}" aria-label="Deschide Jurnalul meu"></a>
    </div>


    <div sec:authorize="hasRole('User') and !hasRole('Guide')" class="leaderboard leaderboard--premium">
        <div class="leaderboard__head">
            <div class="leaderboard__title">
                <span class="leaderboard__icon"><i class="bi bi-trophy"></i></span>
                <div>
                    <h4 class="m-0">Clasament</h4>
                    <small class="text-muted">Top utilizatori dupÄƒ puncte cheltuite</small>
                </div>
            </div>

            <span class="leaderboard__pill">
      <i class="bi bi-lightning-charge"></i> Live
    </span>
        </div>

        <div class="leaderboard__body">
            <div class="leaderboard__row"
                 th:each="up, iter : ${userPoints}"
                 th:if="${up.user.roles.size()} == 1 and ${up.user.roles[0].name == 'User'}"
                 th:classappend="${up.user.username == user.username} ? ' is-me' : ''">

                <!-- Rank -->
                <div class="leaderboard__rank"
                     th:classappend="${iter.index == 0} ? ' is-gold' : (${iter.index == 1} ? ' is-silver' : (${iter.index == 2} ? ' is-bronze' : ''))"
                     th:text="${iter.index + 1}">
                </div>

                <!-- Avatar -->
                <div th:if="${up.user.username == user.username}"
                     class="leaderboard__avatar"
                     data-bs-toggle="modal"
                     data-bs-target="#avatarModal"
                     style="cursor:pointer;">
                    <div class="leaderboard__avatar-wrap">
                        <img th:src="@{'https://api.dicebear.com/9.x/personas/svg?seed=' + ${up.user.avatar}}"
                             alt="Avatar" class="avatar">
                        <img th:if="${up.level >= 5}"
                             th:src="@{'/imagini/rame/frame' + ${frameNumbers[up.user.id]} + '.gif'}"
                             class="avatar-frame">
                    </div>
                </div>

                <div th:if="${up.user.username != user.username}"
                     class="leaderboard__avatar"
                     style="cursor:default;">
                    <div class="leaderboard__avatar-wrap">
                        <img th:src="@{'https://api.dicebear.com/9.x/personas/svg?seed=' + ${up.user.avatar}}"
                             alt="Avatar" class="avatar">
                        <img th:if="${up.level >= 5}"
                             th:src="@{'/imagini/rame/frame' + ${frameNumbers[up.user.id]} + '.gif'}"
                             class="avatar-frame">
                    </div>
                </div>

                <!-- Nume + level -->
                <div class="leaderboard__user">
                    <div class="leaderboard__name">
                        <span th:text="${up.user.username}">username</span>
                        <span class="leaderboard__you" th:if="${up.user.username == user.username}">Tu</span>
                    </div>
                    <div class="leaderboard__sub text-muted">
                        <span th:text="'Nivel ' + ${up.level}">Nivel 1</span>
                        <span class="leaderboard__sub-xp text-muted" th:text="'XP: ' + ${up.xpoints}">XP: 0</span>
                    </div>
                </div>

                <!-- Scor -->
                <div class="leaderboard__score"
                     th:utext="${pointsSpent[up.user.id]} + ' <i class=&quot;fa-regular fa-money-bill-1&quot;></i>'">
                </div>
            </div>
        </div>



        <div sec:authorize="hasRole('User') and !hasRole('Guide')" class="purchase-list purchase-list--premium">

        <div class="purchase__head">
            <div class="purchase__title">
                <span class="purchase__icon"><i class="bi bi-bag-check"></i></span>
                <div>
                    <h4 class="m-0">Excursiile mele</h4>
                    <small class="text-muted">Tururi cumpÄƒrate È™i disponibile pentru itinerarii</small>
                </div>
            </div>

            <span class="purchase__pill"
                  th:text="${purchases != null ? (#lists.size(purchases) + ' total') : '0 total'}">
      0 total
    </span>
        </div>

        <div class="purchase__body">

            <!-- Empty state -->
            <div class="purchase-empty" th:if="${purchases == null or #lists.isEmpty(purchases)}">
                <div class="purchase-empty__icon"><i class="bi bi-compass"></i></div>
                <div>
                    <div class="fw-bold">Nu ai cumpÄƒrat nimic Ã®ncÄƒ</div>
                    <div class="text-muted small">DescoperÄƒ tururi È™i adaugÄƒ-le Ã®n itinerarii.</div>
                </div>
                <a class="btn btn-sm btn-accent-outline ms-auto" th:href="@{/Tours}">
                    Vezi tururi
                </a>
            </div>

            <!-- ListÄƒ mini-carduri -->
            <div class="purchase-grid" th:if="${purchases != null and !#lists.isEmpty(purchases)}">

                <div class="purchase-item" th:each="p : ${purchases}">
                    <div class="purchase-item__left">
                        <div class="purchase-item__badge">
                            <i class="bi bi-geo-alt"></i>
                        </div>

                        <div class="purchase-item__content">
                            <div class="purchase-item__title" th:text="${p.tour.title}">Titlu tur</div>
                            <div class="purchase-item__meta text-muted">
              <span>
                <i class="bi bi-calendar3"></i>
                <span th:text="${#temporals.format(p.purchasedAt, 'dd.MM.yyyy')}">01.01.2025</span>
              </span>
                                <span class="dot">â€¢</span>
                                <span>
                <i class="bi bi-cash-coin"></i>
                <span th:text="${p.tour.pricePoints} + ' puncte'">0 puncte</span>
              </span>
                            </div>
                        </div>
                    </div>

                    <div class="purchase-item__right">
                        <a class="btn btn-sm btn-accent-outline"
                           th:href="@{/tours/{id}(id=${p.tour.id})}">
                            Vezi turul
                        </a>
                    </div>
                </div>

            </div>

        </div>
    </div>

    <!-- CARD: Jurnalul meu (sub Leaderboard + Excursiile mele) -->



    <div sec:authorize="hasRole('Guide')" class="list_tours">
        <section id="featured-destinations" class="featured-destinations section">
            <div class="container section-title">
                <h2>Tururile Dumneavoastra</h2>
                <div><span>Vizualizati</span> <span class="description-title">Tururile Postate</span></div>
            </div>

            <div class = 'container'>
                <div th:if="${#lists.isEmpty(calatorii)}">
                    <p>Nu aveÈ›i Ã®ncÄƒ tururi.</p>
                </div>
                <div class="row gy-4" th:if="${!#lists.isEmpty(calatorii)}">
                    <div class="col-lg-4 col-md-6" th:each="c : ${calatorii}">
                        <div class="destination-card">
                            <div class="image-wrapper">
                                <img th:src="@{/uploads/{img}(img=${c.image})}" alt="DestinaÈ›ie" class="img-fluid">
                            </div>

                            <div class="content">
                                <h4 th:text="${c.title}">Titlu</h4>
                                <p th:text="${#strings.abbreviate(c.pricePoints, 100)}">Descriere</p>

                                <div class="card-footer">
                                    <form th:action="@{/tours/delete/{id}(id=${c.id})}" method="post">
                                        <button class="btn btn-danger"
                                                onclick="return confirm('EÈ™ti sigur cÄƒ vrei sÄƒ È™tergi acest tur?');">
                                            Delete
                                        </button>
                                    </form>
                                    <form th:action="@{/Itravel/edit/{id}(id=${c.id})}" method="get">
                                        <button  class="btn btn-login w-100">
                                            Edit
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>
    </div>
</div>
</div>
</html>
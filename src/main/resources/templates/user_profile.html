<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      layout:decorate="~{layout}">

<div class="content-wrapper" layout:fragment="content">
    <!--Page Title-->
    <div class="page-title dark-background" th:style="|background-image: url('@{/walpaper/showcase-7.webp}');|">
        <div class="container position-relative">
            <h1>Welcome to ITravel</h1>
            <p>This is your profile.</p>

        </div>
    </div> <!--End Page Title-->
    <style>
        .profile-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-areas:
                "avatar info"
                "tours tours";/* douÄƒ coloane egale */
            max-width: 1200px; /* le È›inem Ã®nguste È™i elegante */
            margin: 0 auto; /* centrare pe paginÄƒ */
            gap: 30px; /* distanÈ›Äƒ frumoasÄƒ Ã®ntre carduri */
            padding: 20px;
        }

        .profile-avatar{
            grid-area: avatar;
        }
        .profile-info{
            grid-area: info;
        }
        .list_tours{
            grid-area: tours;
        }

        .profile-avatar,
        .profile-info {
            background: var(--surface-color);
            border-radius: 10px;
            border: 1px solid rgba(0,0,0,0.1);
            padding: 30px 40px; /* spatiu mai bun L-R */
            transition: all 0.3s ease;
            box-sizing: border-box;
            text-align: center; /* center pentru titluri & text simplu */
        }

        /* fix pentru lista din profile-info */
        .profile-info ul {
            list-style: none;        /* scoate bullet-urile */
            padding: 0;
            margin: 0;
        }

        .profile-info ul li {
            text-align: center;      /* alineazÄƒ fiecare item */
            margin-bottom: 8px;      /* spacing frumos */
        }
        .profile-avatar,
        .profile-info ,
        .leaderboard,
        .purchased_tours{
            background: var(--surface-color);
            border-radius: 10px;
            border: 1px solid rgba(0,0,0,0.1);
            padding: 30px;
            transition: all 0.3s ease;
            box-sizing: border-box;
        }

        /* Hover effect */
        .profile-avatar:hover,
        .profile-info:hover ,
        .leaderboard:hover,
        .purchased_tours:hover{
            transform: translateY(-8px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
            border-color: rgba(0,0,0,0.2);
        }

        .leaderboard-row.me {
            background: linear-gradient(90deg, #ffe066, #ffcc00);
            animation: glow 1.5s ease-in-out infinite alternate;
            font-weight: bold;
            border-radius: 8px;
        }

        @keyframes glow {
            from {
                box-shadow: 0 0 5px #ffea70;
            }
            to {
                box-shadow: 0 0 20px #ffd60a;
            }
        }
    </style>
<div class="profile-container">
    <div class="profile-avatar">
        <!--<img th:src="@{'https://api.dicebear.com/9.x/dylan/svg?seed=' + ${user.avatar}}" style="height: 300px; width: 300px" class="rounded-circle me-2 border avatar-option-nav">-->
        <div class="avatar-container me-6"
             data-bs-toggle="modal"
             data-bs-target="#avatarModal"
             style="cursor: pointer; position: relative;">

            <!-- Avatar -->
            <img th:src="${navbarAvatarUrl}"
                 alt="Avatar"
                 class="avatar"
                 th:classappend="${navbarLevelClass}">

            <!-- Rama GIF -->
            <img th:if="${navbarFrameGif != null}"
                 th:src="@{${navbarFrameGif}}"
                 class="avatar-frame">

            <!-- Badge puncte (doar User) -->
            <span sec:authorize="hasRole('User') and !hasRole('Guide')"
                  class="badge points"
                  th:text="${navbarPoints} + 'p'"></span>

            <!-- Badge nivel -->
            <span class="badge level"
                  sec:authorize="isAuthenticated()"
                  th:text="'Lvl ' + ${navbarLevel}"></span>

            <!-- Badge User -->
            <span class="badge role User"
                  sec:authorize="hasRole('User') and !hasRole('Guide')">
        <i class="bi bi-person-fill"></i> User
    </span>

            <!-- Badge Guide -->
            <span class="badge role Guide"
                  sec:authorize="hasRole('Guide')">
        <i class="bi bi-geo-alt-fill"></i> Guide
    </span>

        </div>
        <h4 th:text="${user.username}">Nume utilizator</h4>
    </div>
    <div class="profile-info">
        <h4>Informatii profil</h4>
        <ul>
            <li>Email: <span th:text ="${user.email}">email@example.com</span></li>
            <li> Created at: <span th:text="${user.createdAt}">2025-01-01</span></li>
           <!-- <li>Roles: <span th:text="${user.roles}">Username</span></li>-->
        </ul>
    </div>
    <div sec:authorize="hasRole('User') and !hasRole('Guide')" class="leaderboard">
        <h4>Leaderboard</h4>
        <ul>
            <li th:each="up : ${userPoints}"
                th:class="'leaderboard-row ' + (${up.user.username} == ${user.username} ? 'me' : '')"
                th:if="${up.user.roles.size()} == 1 and ${up.user.roles[0].name == 'User'}">

                <!-- DacÄƒ e user-ul logat, avatar clickabil -->
                <div th:if="${up.user.username == user.username}"
                     class="avatar-container me-1"
                     data-bs-toggle="modal"
                     data-bs-target="#avatarModal"
                     style="cursor: pointer; position: relative;">
                    <div style="position: relative; display: inline-block; margin-right: 10px;">
                        <img th:src="@{'https://api.dicebear.com/9.x/dylan/svg?seed=' + ${up.user.avatar}}"
                             alt="Avatar" class="avatar">
                        <img th:if="${up.level >= 5}"
                             th:src="@{'/imagini/rame/frame' + ${frameNumbers[up.user.id]} + '.gif'}"
                             class="avatar-frame">
                    </div>
                </div>

                <!-- DacÄƒ e alt user, avatar doar vizual -->
                <div th:if="${up.user.username != user.username}"
                     class="avatar-container me-1"
                     style="cursor: default; position: relative;">
                    <div style="position: relative; display: inline-block; margin-right: 10px;">
                        <img th:src="@{'https://api.dicebear.com/9.x/dylan/svg?seed=' + ${up.user.avatar}}"
                             alt="Avatar" class="avatar">
                        <img th:if="${up.level >= 5}"
                             th:src="@{'/imagini/rame/frame' + ${frameNumbers[up.user.id]} + '.gif'}"
                             class="avatar-frame">
                    </div>
                </div>

                <span th:text="${up.user.username}"></span> -
                <span th:text="${up.points} + 'p'"></span>
            </li>
        </ul>
    </div>
    <div sec:authorize="hasRole('User') and !hasRole('Guide')" class="purchased_tours">
        <h4>Excursiile mele</h4>

        <div th:if="${#lists.isEmpty(purchases)}">
            <p>Nu ai cumpÄƒrat nimic Ã®ncÄƒ ðŸ˜¢</p>
        </div>

        <ul th:if="${!#lists.isEmpty(purchases)}">
            <li th:each="p : ${purchases}">
                <span th:text="${p.tour.title}"></span>
                â€“
                <span th:text="${p.pointsPaid} + 'p'"></span>
                <small th:text="${#temporals.format(p.purchasedAt, 'dd.MM.yyyy')}"></small>
            </li>
        </ul>
    </div>
    <div sec:authorize="hasRole('Guide')" class="list_tours">
        <section id="featured-destinations" class="featured-destinations section">
            <div class="container section-title">
                <h2>Tururile Dumneavoastra</h2>
                <div><span>Vizualizati</span> <span class="description-title">Tururile Postate</span></div>
            </div>

            <div class = 'container'>
                <div th:if="${#lists.isEmpty(calatorii)}">
                    <p>Nu aveÈ›i Ã®ncÄƒ tururi.</p>
                </div>
                <div class="row gy-4" th:if="${!#lists.isEmpty(calatorii)}">
                    <div class="col-lg-4 col-md-6" th:each="c : ${calatorii}">
                        <div class="destination-card">
                            <div class="image-wrapper">
                                <img th:src="@{/uploads/{img}(img=${c.image})}" alt="DestinaÈ›ie" class="img-fluid">
                            </div>

                            <div class="content">
                                <h4 th:text="${c.title}">Titlu</h4>
                                <p th:text="${#strings.abbreviate(c.pricePoints, 100)}">Descriere</p>

                                <div class="card-footer">
                                    <form th:action="@{/tours/delete/{id}(id=${c.id})}" method="post">
                                        <button class="btn btn-danger"
                                                onclick="return confirm('EÈ™ti sigur cÄƒ vrei sÄƒ È™tergi acest tur?');">
                                            Delete
                                        </button>
                                    </form>
                                    <form th:action="@{/Itravel/edit/{id}(id=${c.id})}" method="get">
                                        <button  class="btn btn-login w-100">
                                            Edit
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>
    </div>
</div>
</div>
</html>